<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alumni Portal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <a href="{{ url_for('home') }}">
                    <img src="{{ url_for('static', filename='images/' + (institute_logo if institute_logo else 'logo.png')) }}" alt="Institute Logo">
                </a>
            </div>
            <div class="menu-toggle">&#9776;</div>
            <ul>
                <li><a href="{{ url_for('home') }}">Home</a></li>
                <li><a href="{{ url_for('events_list') }}">Events</a></li>
                <li><a href="{{ url_for('alumni_directory') }}">Alumni</a></li>
                {% if current_user.is_authenticated %}
                    {% if current_user.role.name == 'Institute_Admin' %}
                        <li><a href="{{ url_for('dashboard') }}">Admin Panel</a></li>
                    {% else %}
                        <li><a href="{{ url_for('dashboard') }}">My Dashboard</a></li>
                    {% endif %}
                    <li><a href="{{ url_for('logout') }}" class="login-button">Logout</a></li>
                {% else %}
                    <li><a href="#">Contact</a></li>
                    <li><a href="{{ url_for('google_login') }}" class="login-button">Login with Google</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    <main>
        <section id="hero">
            <h1>Welcome Back, Alumni!</h1>
            <p>Reconnect with your classmates, explore career opportunities, and stay informed about the latest campus news and events.</p>
            <a href="{{ url_for('alumni_directory') }}" class="cta-button">Join the Community</a>
        </section>

        <section id="events">
            <h2>Upcoming Events</h2>
            <div class="events-wrapper">
                {% for event in events %}
                <div class="event-card">
                    <h3>{{ event.title }}</h3>
                    <p>Date: {{ event.date_time.strftime('%b %d, %Y') }} | Location: {{ event.location }}</p>
                    <a href="#">Details & RSVP</a>
                </div>
                {% else %}
                <p style="text-align: center; width: 100%;">No upcoming events scheduled at this time.</p>
                {% endfor %}
            </div>
        </section>

        <section id="jobs">
            <h2>Alumni Job Board</h2>
            <ul>
                <li>Software Developer at TechCorp <span class="job-tag">Full-Time</span></li>
                <li>Marketing Manager at Creative Solutions <span class="job-tag">Remote</span></li>
                <li>Financial Analyst at Global Bank <span class="job-tag">Entry-Level</span></li>
            </ul>
            <a href="#" class="cta-button secondary">View All Listings</a>
        </section>

        <section id="team">
            <h2>Meet the Team</h2>
            <div class="team-grid">
                <div class="team-member"><div class="team-member-photo"></div><h4>Teammate 1 Name</h4><p>Role/Title</p></div>
                <div class="team-member"><div class="team-member-photo"></div><h4>Teammate 2 Name</h4><p>Role/Title</p></div>
                <div class="team-member"><div class="team-member-photo"></div><h4>Teammate 3 Name</h4><p>Role/Title</p></div>
                <div class="team-member"><div class="team-member-photo"></div><h4>Teammate 4 Name</h4><p>Role/Title</p></div>
                <div class="team-member"><div class="team-member-photo"></div><h4>Teammate 5 Name</h4><p>Role/Title</p></div>
            </div>
        </section>
    </main>

    <button id="chat-toggle-button">ðŸ’¬ Chat</button>
    <div id="chatbot-popup" class="hidden">
        <div id="chat-header">
            <span>Alumni Assistant</span>
            <button id="chat-close-button">&times;</button>
        </div>
        <div id="chat-messages">
            <div class="message bot">Hello! How can I help you today?</div>
        </div>
        <div id="chat-input-area">
            <input type="text" id="chat-input" placeholder="Ask something...">
            <button id="chat-send-button">Send</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Alumni Network | Privacy Policy | Connect with us.</p>
    </footer>

    <script>
        const menuToggle = document.querySelector('.menu-toggle');
        const navUl = document.querySelector('nav ul');
        if (menuToggle && navUl) {
            menuToggle.addEventListener('click', () => {
                navUl.classList.toggle('active');
            });
        }
    </script>
    
    <script>
        const heroSection = document.getElementById('hero');
        if (heroSection) {
            heroSection.addEventListener('mousemove', (e) => {
                const rect = heroSection.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                heroSection.style.setProperty('--mouse-x', `${x}px`);
                heroSection.style.setProperty('--mouse-y', `${y}px`);
            });
            heroSection.addEventListener('mouseleave', () => {
                heroSection.style.setProperty('--mouse-x', `50%`);
                heroSection.style.setProperty('--mouse-y', `50%`);
            });
        }
    </script>
    
    <script>
        const chatToggleButton = document.getElementById('chat-toggle-button');
        const chatbotPopup = document.getElementById('chatbot-popup');
        const chatCloseButton = document.getElementById('chat-close-button');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSendButton = document.getElementById('chat-send-button');

        if (chatToggleButton) {
            chatToggleButton.addEventListener('click', () => {
                chatbotPopup.classList.toggle('hidden');
                chatToggleButton.classList.toggle('active');
            });
        }
        if (chatCloseButton) {
            chatCloseButton.addEventListener('click', () => {
                chatbotPopup.classList.add('hidden');
                if (chatToggleButton) chatToggleButton.classList.remove('active');
            });
        }
        if (chatSendButton) chatSendButton.addEventListener('click', sendMessage);
        if (chatInput) chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });

        async function sendMessage() {
            const messageText = chatInput.value.trim();
            if (!messageText) return;

            appendMessage('user', messageText);
            chatInput.value = '';
            chatInput.disabled = true;
            chatSendButton.disabled = true;

            const thinkingDiv = appendMessage('bot', 'Thinking...');
            thinkingDiv.classList.add('thinking');

            try {
                const response = await fetch('/api/chatbot', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: messageText }),
                });
                thinkingDiv.remove();
                if (!response.ok) {
                    const errorData = await response.json();
                    appendMessage('bot', errorData.reply || 'Sorry, I faced an error. Please try again.');
                } else {
                    const data = await response.json();
                    appendMessage('bot', data.reply);
                }
            } catch (error) {
                 thinkingDiv.remove();
                 appendMessage('bot', 'Sorry, could not connect to the assistant.');
                 console.error('Chatbot fetch error:', error);
            } finally {
                chatInput.disabled = false;
                chatSendButton.disabled = false;
                chatInput.focus();
            }
        }

        function appendMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return messageDiv;
        }
    </script>
</body>
</html>